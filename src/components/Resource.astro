---
import Card from './Card.astro';

type Props = {
  title: string;
  icon: 'mail';
  link:
    | {
        kind: 'standard';
        href: string;
      }
    | {
        kind: 'mailto';
        name: string;
        domain: string;
      };
};

const { icon, link, title } = Astro.props;
---

<Card class="group duration-200 hover:scale-105">
  <button
    class="resource-btn flex h-full w-full gap-4 p-5"
    data-href={link.kind === 'standard' && link.href}
    data-mailto={link.kind === 'mailto'}
    type="button"
  >
    <div class="flex w-full max-w-16 items-center justify-center">
      <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        {
          icon === 'mail' && (
            <Fragment>
              <path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z" />
              <path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z" />
            </Fragment>
          )
        }
      </svg>
    </div>
    <div class="flex w-full flex-col gap-2 text-left">
      <h5 class="text-lg font-semibold">{title}</h5>
      <span
        class:list={[
          'text-sm group-hover:underline',
          link.kind === 'mailto' && 'flex before:content-[attr(data-name)] after:content-[attr(data-domain)]'
        ]}
        data-name={link.kind === 'mailto' && link.name}
        data-domain={link.kind === 'mailto' && link.domain}
      >
        {link.kind === 'mailto' ? '@' : link.href.replace(/^https?:\/\//, '')}
      </span>
    </div>
  </button>
</Card>
<script>
  document.querySelectorAll<HTMLDivElement>('.resource-btn').forEach((button) => {
    if (button.hasAttribute('data-mailto')) {
      const span = button.querySelector<HTMLSpanElement>('span[data-name][data-domain]')!;
      button.addEventListener('click', function () {
        window.location.href = `mailto:${span.dataset.name}@${span.dataset.domain}`;
      });
    } else {
      const href = button.getAttribute('data-href')!;
      button.addEventListener('click', function () {
        window.open(href);
      });
    }
  });
</script>
